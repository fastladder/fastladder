language: ruby
rvm:
  - 2.2.7
  - 2.3.4
  - 2.4.1
  - ruby-head
node_js:
  - 6

sudo: false

matrix:
  allow_failures:
    - rvm: ruby-head

branches:
  only:
    - master

before_install:
  - cp config/database.yml.sqlite3 config/database.yml

install:
  - bundle install --without development production --jobs 3 --retry 3
  - yarn install

before_script:
  - RAILS_ENV=test ./bin/rake fastladder:setup

script:
  - yarn lint || echo '' # todo
  - yarn test
  - RAILS_ENV=test bundle exec rake db:drop db:create db:migrate assets:precompile spec
  - RAILS_ENV=production bundle exec rake assets:precompile
